<html>
<head>

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>

  <script src="src/cloverCloud-min.js"></script>

  <link rel="stylesheet" type="text/css" href="appStyle.css">
</head>

<body onbeforeunload="clover.close()">

<p>
  This is a simple Example of the Clover High Level Cloud API.  It relies on the device to be running the
  Cloud Pay Display app.  It uses the device serial id to identify the device.  It makes a connection to
  a device, and voids a payment made in an earlier operation.  The result of the transaction is displayed
  below.
</p>

<!-- this is a place to talk about what is happening while the example is being run -->
<div id="uiFeedback" style="height: 400px;">
</div>

<script>

  // Create the Clover object to communicate with the device
  var clover = new Clover(
      {
        "clientId" : "3RPTN642FHXTC",
        "domain" : "https://dev1.dev.clover.com/",
        "merchantId" : "BBFF8NBCXEMDT",
        "deviceSerialId" : "C030UQ50550081"
      });

  // Start communication
  clover.initDeviceConnection();

  // When the device is ready, start a transaction.
  clover.notifyWhenDeviceIsReady(makeAVoid);

  // This will be called when the device is ready
  function makeAVoid() {
    var payment = {
      "result": "SUCCESS",
      "createdTime": 1439928976133,
      "taxRates": null,
      "cardTransaction": {
        "authCode": "11893",
        "entryType": "SWIPED",
        "extra": {
          "cvmResult": "SIGNATURE"
        },
        "state": "CLOSED",
        "referenceId": "1871206905",
        "type": "AUTH",
        "transactionNo": null,
        "last4": "9571",
        "cardType": "MC"
      },
      "offline": false,
      "cashTendered": null,
      "amount": 12345,
      "id": "SFGKWFQCQWNZ4",
      "tipAmount": 0,
      "lineItemPayments": null,
      "taxAmount": 0,
      "order": {
        "id": "YDKAH33H7504C"
      },
      "tender": {
        "id": "PB00TG1DFNHJC",
        "enabled": true,
        "visible": true,
        "instructions": null,
        "labelKey": "com.clover.tender.credit_card",
        "label": "Credit Card",
        "opensCashDrawer": false,
        "editable": false
      },
      "employee": {
        "id": "DFLTEMPLOYEE"
      },
      "externalPaymentId": null,
      "cashbackAmount": null
    }

    // Call the device to take payment, after the payment is complete, call the
    // 'mySaleResult' function
    clover.voidTransaction(payment, resultCallback);
  }

  /**
   *
   * @param saleResult - adheres to the node.js style of error first callbacks.
   * @see http://fredkschott.com/post/2014/03/understanding-error-first-callbacks-in-node-js/
   */
  function resultCallback(error, resultData) {
    // do something with this.
    var resultDisplay = "";
    if(error)resultDisplay += "<pre>"+JSON.stringify(error, null, 4) + "</pre>";
    resultDisplay += "<pre>"+JSON.stringify(resultData, null, 4) + "</pre>";
    document.getElementById("uiFeedback").innerHTML = resultDisplay;
  }
</script>

</body>
</html>
